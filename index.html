<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>One-Minute Meditation</title>
  <style>
    :root {
      --bg: #2c5364;
      --fg: white;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      color: var(--fg);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }

    .circle {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: 3px solid var(--fg);
      animation: breathe 12s infinite;
    }

    @keyframes breathe {
      0% { transform: scale(1); }
      25% { transform: scale(1.3); }
      50% { transform: scale(1.3); }
      75% { transform: scale(1); }
    }

    h1 {
      margin-top: 20px;
      font-weight: 300;
    }

    #instruction {
      font-size: 1.4rem;
      margin: 12px 0;
    }

    #timer {
      font-size: 2rem;
      margin: 10px 0;
    }

    .settings {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
    }

    button, select, input {
      padding: 10px;
      font-size: 1rem;
      border: none;
      border-radius: 5px;
      background: rgba(255,255,255,0.2);
      color: var(--fg);
      cursor: pointer;
    }

    button:hover, select:hover {
      background: rgba(255,255,255,0.3);
    }
  </style>
</head>
<body>

  <div class="circle"></div>
  <h1>One-Minute Meditation</h1>
  <div id="instruction">Ready to begin</div>
  <div id="timer">60</div>

  <div class="settings">
    <select id="duration">
      <option value="60">1 Minute</option>
      <option value="180">3 Minutes</option>
      <option value="300">5 Minutes</option>
      <option value="600">10 Minutes</option>
    </select>

    <select id="voiceSelect">
      <option>Loading voices...</option>
    </select>

    <button onclick="toggleTheme()">Toggle Theme</button>
    <button onclick="toggleMusic()">Music: On</button>
    <button onclick="startMeditation()">Start</button>
  </div>

  <div class="settings">
    <input type="time" id="reminderTime">
    <button onclick="setReminder()">Set Daily Reminder</button>
  </div>

  <audio id="ambient-sound" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>

  <script>
    const timerDisplay = document.getElementById('timer');
    const instruction = document.getElementById('instruction');
    const audio = document.getElementById('ambient-sound');
    const durationSelect = document.getElementById('duration');
    const voiceSelect = document.getElementById('voiceSelect');
    const reminderInput = document.getElementById('reminderTime');

    let voices = [];
    let selectedVoice;
    let countdown;
    let musicOn = true;
    let reminderTimeout;

    const synth = window.speechSynthesis;

    function populateVoices() {
      voices = synth.getVoices();
      voiceSelect.innerHTML = '';
      voices.forEach((voice, index) => {
        const option = document.createElement('option');
        option.value = index;
        option.textContent = `${voice.name} (${voice.lang}) ${voice.default ? ' â€” Default' : ''}`;
        voiceSelect.appendChild(option);
      });
      selectedVoice = voices[voiceSelect.value || 0];
    }

    synth.onvoiceschanged = populateVoices;

    function speak(text) {
      const utter = new SpeechSynthesisUtterance(text);
      selectedVoice = voices[voiceSelect.value] || synth.getVoices()[0];
      utter.voice = selectedVoice;
      utter.rate = 1;
      synth.speak(utter);
    }

    function toggleTheme() {
      const dark = getComputedStyle(document.body).getPropertyValue('--bg') === '#2c5364';
      document.body.style.setProperty('--bg', dark ? '#f5f5f5' : '#2c5364');
      document.body.style.setProperty('--fg', dark ? '#111' : 'white');
    }

    function toggleMusic() {
      musicOn = !musicOn;
      audio[musicOn ? 'play' : 'pause']();
      event.target.textContent = `Music: ${musicOn ? 'On' : 'Off'}`;
    }

    function startMeditation() {
      clearInterval(countdown);
      synth.cancel();
      if (musicOn) audio.play();
      let secondsLeft = parseInt(durationSelect.value);
      let phaseIndex = 0;
      const phases = [
        { label: "Breathe In", duration: 4 },
        { label: "Hold", duration: 4 },
        { label: "Breathe Out", duration: 4 },
        { label: "Hold", duration: 4 }
      ];

      timerDisplay.textContent = secondsLeft;
      instruction.textContent = "Starting...";
      speak("Starting meditation");

      setTimeout(() => {
        runCycle();
        countdown = setInterval(() => {
          secondsLeft--;
          timerDisplay.textContent = secondsLeft;
          if (secondsLeft <= 0) {
            clearInterval(countdown);
            audio.pause();
            speak("Meditation complete.");
            instruction.textContent = "Done. Namaste.";
          }
        }, 1000);
      }, 1500);

      function runCycle() {
        if (secondsLeft <= 0) return;
        const phase = phases[phaseIndex % phases.length];
        instruction.textContent = phase.label;
        speak(phase.label);
        phaseIndex++;
        setTimeout(runCycle, phase.duration * 1000);
      }
    }

    function setReminder() {
      const time = reminderInput.value;
      if (!time) return alert("Select a time first");
      localStorage.setItem('reminderTime', time);
      Notification.requestPermission().then(permission => {
        if (permission !== 'granted') {
          alert("Notifications blocked.");
          return;
        }
        scheduleReminder(time);
        alert(`Daily reminder set for ${time}`);
      });
    }

    function scheduleReminder(timeStr) {
      const [hour, minute] = timeStr.split(':').map(Number);
      const now = new Date();
      const next = new Date();
      next.setHours(hour, minute, 0, 0);
      if (next < now) next.setDate(next.getDate() + 1);
      const delay = next - now;

      clearTimeout(reminderTimeout);
      reminderTimeout = setTimeout(() => {
        new Notification("Time to Meditate", {
          body: "Click to begin a moment of peace.",
        });
        scheduleReminder(timeStr); // re-schedule for next day
      }, delay);
    }

    // Load reminder
    window.addEventListener('load', () => {
      populateVoices();
      const savedTime = localStorage.getItem('reminderTime');
      if (savedTime) {
        reminderInput.value = savedTime;
        scheduleReminder(savedTime);
      }
    });

  </script>

</body>
</html>
